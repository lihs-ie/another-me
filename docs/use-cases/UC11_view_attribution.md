# ユースケース UC11: クレジット／ライセンス一覧を確認する

## 目的
- ユーザーがアプリ内で利用している楽曲・背景素材のライセンス情報と帰属文を確認し、適切な表記や再配布条件を把握する。

## アクター
- メインアクター：ユーザー
- サポートアクター：アプリ（AttributionBook 集約、LicenseRecord 集約）

## 事前条件
- 取り込まれた楽曲やアセットに対応する `LicenseRecord` が存在し、`AttributionBook` にエントリが追加済み。

## トリガー
- 設定画面または「About / Credits」パネルで「クレジットを表示」を選択する。

## 基本フロー
1. アプリが `AttributionBook.current()` を読み込み、カテゴリ（楽曲 / 背景 / UI など）順にエントリを表示する。
2. ユーザーが任意のエントリを選択すると、紐づく `LicenseRecord` から詳細（licenseName, licenseUrl, attributionText, allowOffline）を表示する。
3. オフライン利用が許可されている場合はその旨を表示し、許可されていない場合は「オンライン時のみ利用可」と注意喚起する。
4. ユーザーは「ライセンス全文を開く」を選択し、ローカルに保存された LICENSE テキストを閲覧できる。閲覧前に `licenseFileChecksum` が保存値と一致するかを検証し、不整合時は再ダウンロードを促す。
5. 表示を閉じると、元の設定画面に戻る。

## 代替フロー
- **検索フィルタ**: エントリ数が多い場合、テキスト検索やカテゴリフィルタで目的の素材を絞り込む。
- **エクスポート**: ユーザーが「クレジット一覧を書き出す」を選ぶと、AttributionBook をテキストまたは JSON としてエクスポートする。

## 例外フロー
- **エントリ欠落**: 対応する `LicenseRecord` が見つからない場合はデフォルトの警告メッセージを表示し、制作チームへ報告できるフォームを案内する。
- **ファイル読み込み失敗**: LICENSE テキストが見つからない場合、再ダウンロードを促しつつ、UI に「この素材のライセンスファイルが欠落しています」と表示する。

## 事後条件
- ユーザーは利用中素材の帰属先と利用条件を把握できる。
- 必要に応じてクレジット表記や再配布判断が適切に行える。
# ユースケース UC11: クレジット／ライセンス一覧を確認する

## 外部設計

### 目的
- ユーザーがアプリ内で利用している楽曲・背景素材のライセンス情報と帰属文を確認し、適切な表記や利用条件を把握できるようにする。

### アクター
- メインアクター：ユーザー
- サポートアクター：アプリ（AttributionBook・LicenseRecord 集約）

### 事前条件
- 各素材に対応する `LicenseRecord` が存在し、`AttributionBook` にエントリが登録されている。
- ローカルに LICENSE テキストが保存されている（ダウンロード済み曲・背景）。

### トリガー
- 設定画面または「About / Credits」パネルで「クレジットを表示」を選択する。

### 基本フロー
1. アプリが `AttributionBookRepository.current()` を呼び出し、カテゴリ（楽曲／背景／UI 等）順にエントリ一覧を表示する。
2. ユーザーがエントリを開くと、`LicenseRecord` の詳細（licenseName, licenseURL, attributionText, allowOffline）を表示する。URL は `common.URL` 型で検証済み。
3. オフライン利用可否、再配布条件、クレジット表記例などの追加情報を `AttributionEntry` から取得し、UI へ提示する。
4. 「ライセンス全文を開く」を選択するとローカル LICENSE テキストを表示する。表示前に `licenseFileChecksum` を検証し、不一致であれば再ダウンロードを促す。
5. 表示を閉じると元の設定画面へ戻る。

### 代替フロー
- **検索・フィルタ**：エントリが多い場合、テキスト検索やカテゴリフィルタで絞り込み、該当する `AttributionEntry` だけを表示する。
- **エクスポート**：ユーザーが「クレジット一覧を書き出す」を選択すると、`AttributionBook.export(format)` がテキスト／JSON ファイルを生成し、保存ダイアログを開く。

### 例外フロー
- **エントリ欠落**：対応する `LicenseRecord` が見つからない場合、デフォルト警告を表示し、制作チームへの報告フォームを案内する。
- **LICENSE 読み込み失敗**：ファイルが存在しない場合、再ダウンロードを提案しつつ UI に「ライセンスファイルが欠落しています」と表示する。

### 事後条件
- ユーザーが利用中素材の帰属先・利用条件を把握でき、適切なクレジット表記や再配布判断が可能になる。

## 内部設計

### 関連ドメインモデル

#### AttributionBook（media/licensing）
- 概要：素材ごとの帰属情報を保持する集約。
- 主な振る舞い：
  - `current()`：最新の帰属リストを取得。
  - `entriesByCategory(category)`：カテゴリ別にフィルタ。
  - `export(format)`：クレジット一覧を指定フォーマットで出力。

#### LicenseRecord（licensing）
- 概要：ライセンス本文・署名・オフライン可否などを保持する集約。
- ユースケース利用箇所：詳細表示、LICENSE テキスト整合性チェック。

#### AttributionEntry（media）
- 概要：表示用に整形された帰属データ（引用文、URL、ローカルファイルパス）を保持する値オブジェクト。

### データフロー
1. UI が `AttributionBookRepository.current()` を通じて `AttributionBook` を取得。
2. ユーザーの操作に応じて `AttributionEntry` を表示し、`LicenseRecordRepository.find` で追加情報を読み出す。
3. LICENSE テキスト表示時にファイル読込＋チェックサム検証を行い、必要に応じて再ダウンロードを指示する。
4. エクスポート処理を選択した場合、`AttributionBook.export` → ファイル保存ダイアログ → 完了通知の順で実行する。
